{% extends '@LinkORBNebula/module/base.html.twig' %}

{% block context_content %}
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
      </tr>
    </thead>
    <tbody>
      {% macro renderPageTree(pages, wiki, level) %}
        {% import _self as macros %}
        {% for page in pages %}
          <tr>
            <td>
              {% if level > 0 %}
                <span class="ms-{{ level * 3 }} text-muted">└─</span>
              {% endif %}
              <i class="icon-lux-file-text me-2"></i>
              <a href="{{ path('wiki_page_view', {'wikiName': wiki.name, 'pageName': page.name}) }}">
                {{ page.name }}
              </a>
            </td>
          </tr>
          {% if page.getChildPages()|length > 0 %}
            {{ macros.renderPageTree(page.getChildPages(), wiki, level + 1) }}
          {% endif %}
        {% endfor %}
      {% endmacro %}

      {% import _self as macros %}
      {% if wikiPages|length > 0 %}
        {{ macros.renderPageTree(wikiPages, wiki, 0) }}
      {% else %}
        <tr>
          <td class="text-muted">No pages found</td>
        </tr>
      {% endif %}
    </tbody>
  </table>

  {% if wiki.hasAccessControlExpression %}
    <div class="mt-3 small text-muted">
      <i class="icon-lux-lock me-1"></i> Restricted to <code>{{ wiki.getAccessControlExpression }}</code>
    </div>
  {% endif %}
{% endblock %}
